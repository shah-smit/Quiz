$(function(e){function t(e){var t=$(".message"),n="easeInOutCubic",i=500;t.animate({right:"0%"},i,n).animate({height:"70px"},i,n,function(){$(this).text(e)});for(var o=2;o--;)t.animate({color:"red"},i,n).animate({color:"white"},i,n);t.animate({color:"red"},i,n).delay(1e3).animate({height:"2px"},i,n,function(){$(this).text("")}).animate({right:"-105%"},i,n)}function n(){function e(){i.find(".username").html("Welcome, "+p.username),i.find(".games .number").html(p.games),i.find(".hscore .number").html(p.hscore),r.html("Profile")}function n(){var n=o.find("input").val();return n?(p.username=n,p.games=p.hscore=0,e(),o.toggle("fast"),void i.toggle("fast")):void t("Enter a username!")}if(Modernizr.localstorage){var i=$(".stats"),o=$(".create"),r=$("#side .main");p.username===[]._?(e(),i.show()):(r.html("Create Profile"),o.show()),$(".go").click(n),o.find("input").keydown(function(e){13===e.keyCode?n():0})}}function o(t){if(x.hide(),I.hide(),y.hide(),m>=e.length)r();else{var n=e[m];question_templ=g.compile($("#templ-question").html()),q.html(question_templ({num:m+1,q:n.question})),templ_choice=g.compile($("#templ-choice").html()),$("#choices").append(templ_choice(n.choices)),$("input[type=radio][name=option]").change(function(){id=$("input:radio:checked").attr("id"),t==[]._?0:c(t),c(id),t=id}),w.fadeIn(f),d[m]^[]._&&(c(d[m]),$(".selected").find("input")[0].checked=!0,t=d[m])}}function r(){k.hide(),w.hide(),C.text("Results"),x.show();var n,o=g.compile($("#templ-result").html());for(i=score=0;i<e.length;i++)n=d[i]==e[i].correctAnswer?(score++,!0):!1,x.append(o({message:n?"Correct":"Incorrect",question_num:i+1,colour:n?"green":"red",correct:n,question:e[i].question}));var r=100*score/e.length+.5|0,c=g.compile($("#templ-score").html());I.html(c({score:score,no_qs:e.length,percentage:r})),$(".result").hide(),I.hide(),$("#results div").first().show("fast",function s(){$(this).next("div").show("fast",s)}),I.add(y).fadeIn(),p.hscore=score>p.hscore?(t("New high score!"),score):p.hscore,p.games++,$(".games .number").html(p.games),$(".hscore .number").html(p.hscore)}function c(e){$("label[for="+e+"] li").toggleClass("selected")}function s(e){w.fadeOut(f,function(){q.html(""),$("#choices").html(""),m+=e,o()})}function a(){$("input:radio:checked").length?(d[m]=+$("input:radio:checked").attr("value"),s(1)):t("Select an answer!")}function l(){m&&s(-1)}function h(){m=0,d=[],x.html(""),I.html(""),k.show(),C.text("QUIZ"),o()}function u(t){m=e.length;var n={mix:[0,0,0,0,0,0,0,0],correct:[1,0,0,1,2,0,0,0],wrong:[0,1,1,0,0,1,1,1]};d=n[t],d||console.error("Invalid EndScreen test mode")}var m=0,d=[],f=300,g=Handlebars,p=localStorage,v=$("#wrapper"),w=v.find("#question_wrap"),q=w.find("#question"),_=w.find("#back_button"),b=w.find("#next_button"),k=_.add(b),x=v.find("#results"),I=v.find(".score"),y=v.find("#restart"),C=v.find("#title");_.click(l),b.click(a),y.click(h),n(),$.getJSON("js/questions.json",function(t){e=t,o()}).fail(function(){alert("Sorry, there was a problem!")})});